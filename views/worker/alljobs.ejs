<% layout("/layouts/boilerplateworker")%>
<%- include("../layouts/layout.ejs") %>
    <h1>Available Jobs</h1>

    <div class="filter-container">
        <label for="jobFilter">Filter Jobs:</label>
        <select id="jobFilter" onchange="filterJobs()">
            <option value="all" <%= filter === "all" ? "selected" : "" %>>All Jobs</option>
            <option value="district" <%= filter === "district" ? "selected" : "" %>>Jobs near District</option>
        </select>
    </div>

    <div class="job-container">
        <% if (jobs.length === 0) { %>
            <div class="no-jobs-card">
                <img src="https://cdn-icons-png.flaticon.com/512/2748/2748558.png" alt="No Jobs Icon">
                <h2>No Job openings Currently</h2>
                <p>Looks like there are no job postings available at the moment.</p>
                <p>Please check back later or try changing the filter.</p>
            </div>
        <% } else { %>
            <% for (let i = 0; i < jobs.length; i++) { %>
                <form action="/worker/applyForm/<%= jobs[i]._id %>" method="GET">
                    <div class="job-card">
                        <input type="hidden" name="jobId" value="<%= jobs[i]._id %>">

                        <h2><%= business[i] %></h2>

                        <p><strong>Salary:</strong> â‚¹<%= jobs[i].salary %> per month</p>
                        <p><strong>Business Type:</strong> <%= jobs[i].businessType %></p>
                        <p><strong>Job Role:</strong> <%= jobs[i].jobRole %></p>
                        <p><strong>Description:</strong> <%= jobs[i].jobRoleDescription %></p>
                        <p><strong>Job Hours:</strong> <%= jobs[i].jobHours %> hours/day</p>
                        <p><strong>Vacancies:</strong> <%= jobs[i].vacancies %></p>
                        <p><strong>Location:</strong> <%= jobs[i].location.district %>, <%= jobs[i].location.state %> - <%= jobs[i].location.pinCode %></p>
                        <p><strong>Deadline to Apply:</strong> <%= new Date(jobs[i].deadlineToApply).toLocaleDateString() %></p>

                        <div class="contact-info">
                            <h3>Contact Information</h3>
                            <p><strong>Name:</strong> <%= jobs[i].contactInfo.name %></p>
                            <p><strong>Email:</strong> <%= jobs[i].contactInfo.email %></p>
                            <p><strong>Phone:</strong> <%= jobs[i].contactInfo.phone %></p>
                        </div>

                        <% if (appliedJobIds.includes(jobs[i]._id.toString())) { %>
                            <button type="button" disabled>Applied</button>
                        <% } else { %>
                            <button type="submit">Apply</button>
                        <% } %>
                    </div>
                </form>
            <% } %>
        <% } %>
    </div>

    <script>
        function filterJobs() {
            const filter = document.getElementById("jobFilter").value;
            if (filter === "all") {
                window.location.href = "/worker/alljobs";
            } else {
                window.location.href = "/worker/jobsByDistrict";
            }
        }
    </script>